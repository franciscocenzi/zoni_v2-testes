<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
    /* Estilos para tela */
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        font-size: 10pt;
        color: #000000;
        padding: 8px;
        background-color: transparent !important;
        margin: 0;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: transparent !important;
        padding: 25px;
        box-shadow: 0 0 15px rgba(0,0,0,0.05);
        border-radius: 5px;
    }

    .header {
        text-align: center;
        border-bottom: 3px solid #666666;
        padding-bottom: 15px;
        margin-bottom: 20px;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header h1 {
        font-size: 14pt;
        margin-bottom: 4px;
        color: #333333;
    }

    .header h2 {
        font-size: 11pt;
        margin-top: 0;
        margin-bottom: 8px;
        color: #444444;
        font-weight: normal;
    }

    .header .meta {
        color: #666666;
        font-size: 9pt;
        margin-top: 8px;
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 3px;
        border: 1px solid #e0e0e0;
    }

    h1 {
        font-size: 14pt;
        margin-bottom: 6px;
        color: #000000;
        border-bottom: 2px solid #000000;
        padding-bottom: 2px;
    }

    h2 {
        font-size: 12pt;
        margin-top: 14px;
        margin-bottom: 8px;
        color: #444444;
        background-color: #f0f0f0;
        padding: 8px 12px;
        border-radius: 4px;
        border-left: 4px solid #666666;
    }

    .section {
        margin-bottom: 16px;
        padding: 15px;
        border: 1px solid #dddddd;
        border-radius: 4px;
        background-color: #ffffff;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 8px;
        margin-bottom: 12px;
        font-size: 9pt;
        background-color: #ffffff;
        border: 1px solid #dddddd;
    }

    table th {
        text-align: left;
        background: #f0f0f0;
        padding: 8px 10px;
        border-bottom: 2px solid #cccccc;
        font-weight: bold;
        color: #333333;
        border-right: 1px solid #dddddd;
    }

    table td {
        padding: 8px 10px;
        border-bottom: 1px solid #eeeeee;
        border-right: 1px solid #eeeeee;
    }

    table tr:last-child td {
        border-bottom: none;
    }

    table th:last-child, table td:last-child {
        border-right: none;
    }

    .note-list {
        margin-top: 6px;
        padding-left: 20px;
        background-color: #fafafa;
        padding: 10px 15px;
        border-radius: 3px;
        border: 1px solid #eeeeee;
    }

    .note-list li {
        margin-bottom: 4px;
        padding-left: 5px;
    }

    .small {
        font-size: 8pt;
        color: #666666;
        background-color: #f9f9f9;
        padding: 8px;
        border-radius: 3px;
        border-left: 3px solid #cccccc;
    }

    /* Novos estilos */
    .badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 12px;
        font-size: 8pt;
        font-weight: bold;
        margin-right: 8px;
        margin-bottom: 4px;
    }

    .badge-eixo { background: #e8e8e8; color: #333333; border: 1px solid #cccccc; }
    .badge-especial { background: #f0f0f0; color: #444444; border: 1px solid #cccccc; }
    .badge-macro { background: #e8e8e8; color: #333333; border: 1px solid #cccccc; }
    .badge-ordinaria { background: #f0f0f0; color: #444444; border: 1px solid #cccccc; }

    .alert {
        padding: 12px 15px;
        margin: 12px 0;
        border-radius: 4px;
        font-size: 9pt;
        border-left: 4px solid;
    }

    .alert-high {
        background: #f8f8f8;
        border-left-color: #666666;
        color: #333333;
        border: 1px solid #dddddd;
    }

    .alert-medium {
        background: #f9f9f9;
        border-left-color: #888888;
        color: #444444;
        border: 1px solid #dddddd;
    }

    .alert-low {
        background: #fafafa;
        border-left-color: #aaaaaa;
        color: #555555;
        border: 1px solid #dddddd;
    }

    .param-group {
        margin-bottom: 15px;
        padding-bottom: 12px;
        border-bottom: 1px solid #eeeeee;
        background-color: #fafafa;
        padding: 12px 15px;
        border-radius: 4px;
        border: 1px solid #eeeeee;
    }

    .param-group:last-child {
        border-bottom: none;
    }

    .footer {
        margin-top: 25px;
        padding-top: 15px;
        border-top: 2px solid #cccccc;
        color: #666666;
        font-size: 8pt;
        text-align: center;
        background-color: #f8f8f8;
        padding: 15px;
        border-radius: 4px;
    }

    .legenda {
        font-size: 8pt;
        color: #666666;
        margin-top: 10px;
        background-color: #f9f9f9;
        padding: 8px 12px;
        border-radius: 3px;
        border: 1px solid #eeeeee;
    }

    .legenda span {
        margin-right: 10px;
    }

    .status {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 3px;
        font-size: 8pt;
        font-weight: bold;
        border: 1px solid;
    }

    .status-presente { background: #f0f0f0; color: #333333; border-color: #cccccc; }
    .status-ausente { background: #f8f8f8; color: #666666; border-color: #dddddd; }
    .status-alerta { background: #f5f5f5; color: #444444; border-color: #cccccc; }

    .controls {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #dddddd;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .controls button {
        font-size: 9pt;
        padding: 6px 12px;
        margin-left: 5px;
        background: #666666;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-weight: bold;
    }

    .controls button:hover {
        background: #555555;
    }

    .highlight {
        background-color: #f9f9f9;
        padding: 12px 15px;
        border-left: 4px solid #999999;
        margin: 12px 0;
        border-radius: 4px;
        border: 1px solid #dddddd;
    }

    .warning {
        background-color: #fafafa;
        padding: 12px 15px;
        border-left: 4px solid #777777;
        margin: 12px 0;
        border-radius: 4px;
        border: 1px solid #dddddd;
    }

    /* Estilos para a tabela de inclina√ß√£o */
    .inclinacao-cor {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 8px;
        border: 1px solid #cccccc;
        vertical-align: middle;
    }
    
    .app-flag {
        background-color: #666666;
        color: white;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 8pt;
        font-weight: bold;
        border: 1px solid #555555;
    }
    
    /* Cores para a tabela de inclina√ß√£o */
    .color-1 { background-color: #1a9641; border-color: #0d7a2f; }
    .color-2 { background-color: #fbfdbc; border-color: #e6e6a3; }
    .color-3 { background-color: #fee4a1; border-color: #f5d088; }
    .color-4 { background-color: #fec981; border-color: #f5b868; }
    .color-5 { background-color: #fdae61; border-color: #f59c48; }
    .color-6 { background-color: #d7191c; border-color: #b81417; }

    /* Estilos para impress√£o/PDF */
    @media print {
        body {
            background-color: white !important;
            font-size: 9pt;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 15px;
            box-shadow: none;
            border-radius: 0;
            background-color: white !important;
        }
        
        /* Esconder elementos n√£o desejados na impress√£o */
        .controls,
        .debug,
        button {
            display: none !important;
        }
        
        /* Ajustar margens e cores para impress√£o */
        .section {
            page-break-inside: avoid;
            break-inside: avoid;
            border: 1px solid #cccccc;
            background-color: #ffffff;
            margin-bottom: 15px;
            padding: 12px;
            box-shadow: none;
        }
        
        table {
            background-color: #ffffff;
            border: 1px solid #cccccc;
        }
        
        table th {
            background: #f0f0f0;
            color: #333333;
        }
        
        /* N√∫meros de p√°gina */
        @page {
            margin-top: 2cm;
            margin-bottom: 2.5cm;
            
            @bottom-right {
                content: "P√°gina " counter(page) " de " counter(pages);
                font-size: 8pt;
                color: #666666;
                font-family: "Segoe UI", Arial, sans-serif;
            }
            
            @bottom-left {
                content: "Este √© um documento t√©cnico para refer√™ncia. Consulte a legisla√ß√£o vigente para decis√µes finais e aplica√ß√£o em projetos.";
                font-size: 7pt;
                color: #666666;
                font-style: italic;
                font-family: "Segoe UI", Arial, sans-serif;
            }
        }
        
        /* Evitar quebra de p√°gina em elementos importantes */
        h1, h2, h3 {
            page-break-after: avoid;
        }
        
        .header {
            border-bottom: 2px solid #666666;
            box-shadow: none;
            page-break-before: always;
        }
        
        .footer {
            border-top: 1px solid #cccccc;
            background-color: #f8f8f8;
        }
    }
    
    /* Estilos para a se√ß√£o debug */
    .debug {
        margin-top: 20px;
        padding: 15px;
        border: 1px dashed #999999;
        background: #f9f9f9;
        font-size: 8pt;
        display: none;
        border-radius: 4px;
    }
</style>
</head>
<body>

<div class="controls">
    <button onclick="toggleDebug()">üêõ Debug</button>
</div>

<div class="container">
    <!-- Cabe√ßalho Institucional -->
    <div class="header">
        <h1>PREFEITURA MUNICIPAL DE PORTO BELO/SC</h1>
        <h2>Secretaria Municipal de Planejamento Urbano</h2>
        <h2>Relat√≥rio de An√°lise Urban√≠stica - Z√¥ni v2</h2>
        <div class="meta">
            <p>Gerado em: <strong>{DATA_COMPLETA}</strong> √†s <strong>{HORA}</strong> | Sistema: Z√¥ni v2 ({VERSAO})</p>
            <p>Tipo de an√°lise: <strong>{TIPO_ANALISE}</strong></p>
        </div>
    </div>

    <!-- Dados Cadastrais -->
    <div class="section">
        <h2>1. Dados Cadastrais</h2>
        <table>
            {DADOS_CADASTRAIS}
        </table>
    </div>

    <!-- Dados B√°sicos -->
    <div class="section">
        <h2>2. Dados B√°sicos do Lote/Gleba</h2>
        <table>
            <tr>
                <th width="40%">Tipo de An√°lise</th>
                <td>{TIPO_ANALISE}</td>
            </tr>
            <tr>
                <th>Quantidade de Lotes Considerados</th>
                <td>{N_LOTES}</td>
            </tr>
            <tr>
                <th>√Årea Total Considerada (m¬≤)</th>
                <td>{AREA_LOTE}</td>
            </tr>
            <tr>
                <th>N√∫mero de Testadas</th>
                <td>{N_TESTADAS}</td>
            </tr>
            <tr>
                <th>Testada Principal</th>
                <td>{TESTADA_PRINCIPAL}</td>
            </tr>
        </table>
    </div>

    <!-- Limites do Terreno -->
    <div class="section">
        <h2>3. Limites do Terreno (Testadas e Divisas)</h2>
        <table>
            <tr>
                <th>Limite</th>
                <th>Comprimento (m)</th>
            </tr>
            {TABELA_TESTADAS}
        </table>
        <p class="small">
            <strong>Testadas:</strong> limites do terreno com frente para logradouro p√∫blico (rua, avenida, pra√ßa, servid√£o etc.)<br>
            <strong>Divisas:</strong> limites em confronta√ß√£o com outros im√≥veis, p√∫blicos ou privados
        </p>
    </div>

    <!-- Zoneamentos Incidentes -->
    <div class="section">
        <h2>4. Zoneamentos Incidentes</h2>
        <table>
            {TABELA_ZONAS}
        </table>

        <div class="legenda">
            <span class="badge badge-eixo">EIXO</span>
            <span class="badge badge-especial">ESPECIAL</span>
            <span class="badge badge-macro">MACRO</span>
            <span class="badge badge-ordinaria">ORDIN√ÅRIA</span>
        </div>

        <div class="highlight">
            <p><strong>Zona de refer√™ncia para s√≠ntese de √≠ndices:</strong> {ZONA_PRINCIPAL}</p>
            <p><strong>Justificativa / observa√ß√µes sobre aplica√ß√£o de par√¢metros:</strong><br>
            {JUSTIFICATIVA}</p>
        </div>
    </div>

    <!-- Par√¢metros Urban√≠sticos -->
    <div class="section">
        <h2>5. Par√¢metros Urban√≠sticos Aplic√°veis</h2>
        
        <div class="param-group">
            <h3>Coeficiente de Aproveitamento (CA)</h3>
            <table>
                <tr><td width="70%">CA M√≠nimo</td><td>{CA_MIN}</td></tr>
                <tr><td>CA B√°sico</td><td>{CA_BAS}</td></tr>
                <tr><td>CA M√°ximo Ajustado</td><td>{CA_MAX_AJ}</td></tr>
            </table>
        </div>

        <div class="param-group">
            <h3>Taxas</h3>
            <table>
                <tr><td width="70%">Taxa de Permeabilidade do Solo (TPS)</td><td>{TPS}</td></tr>
                <tr><td>Taxa de Ocupa√ß√£o do Solo (TOS)</td><td>{TOS}</td></tr>
            </table>
        </div>

        <div class="param-group">
            <h3>Recuos</h3>
            <table>
                <tr><td width="70%">Recuo Frontal M√≠nimo</td><td>{RF}</td></tr>
                <tr><td>Recuo Frontal com Espelho d'√Ågua / Via Secund√°ria</td><td>{RFU}</td></tr>
                <tr><td>Recuos Laterais/Fundos</td><td>{RL}</td></tr>
            </table>
        </div>

        <div class="param-group">
            <h3>Edifica√ß√£o</h3>
            <table>
                <tr><td width="70%">N¬∫ de Pavimentos B√°sico</td><td>{NP_BAS}</td></tr>
                <tr><td>N¬∫ de Pavimentos M√°ximo Ajustado</td><td>{NP_MAX_AJ}</td></tr>
                <tr><td>Altura M√°xima de Embasamento (m)</td><td>{HEMB}</td></tr>
                <tr><td>Vagas M√≠nimas Estimadas</td><td>{VAGAS}</td></tr>
            </table>
        </div>

        <div class="warning">
            <p class="small">
                <strong>Notas importantes:</strong><br>
                (3) Caso haja aberturas voltadas para limites laterais ou de fundos, aplica-se a regra espec√≠fica
                prevista na nota (3) da tabela de par√¢metros urban√≠sticos (Anexo III da LC 275/2025).<br>
                (13) Quando houver torre recuada sobre embasamento, o recuo frontal da torre deve ser calculado
                conforme a f√≥rmula indicada na nota (13) da mesma tabela.
            </p>
        </div>
    </div>

    <!-- APP -->
    <div class="section">
        <h2>6. √Åreas de Preserva√ß√£o Permanente (APP)</h2>
        <table>
            <tr>
                <th width="30%">Tipo de APP</th>
                <th width="20%">Status</th>
                <th width="20%">Largura Faixa</th>
                <th width="30%">Observa√ß√µes</th>
            </tr>
            <tr>
                <td>Faixa AUC (curso d'√°gua)</td>
                <td><span class="status {APP_FAIXA_CLASSE}">{APP_FAIXA_STATUS}</span></td>
                <td>{APP_FAIXA_LARGURA}</td>
                <td>{APP_FAIXA_OBS}</td>
            </tr>
            <tr>
                <td>Manguezal</td>
                <td><span class="status {APP_MANGUE_CLASSE}">{APP_MANGUE_STATUS}</span></td>
                <td>-</td>
                <td>{APP_MANGUE_OBS}</td>
            </tr>
        </table>
        <p class="small">
            <strong>Base:</strong> Camadas AMFRI_PB_LLNUIAPP e AMFRI_PB_Area_Manguezal
        </p>
    </div>

    <!-- Riscos -->
    <div class="section">
        <h2>7. Riscos Geoambientais</h2>
        <table>
            <tr>
                <th width="25%">Tipo de Risco</th>
                <th width="20%">Classe</th>
                <th width="20%">Grau</th>
                <th width="35%">Recomenda√ß√µes</th>
            </tr>
            <tr>
                <td>Inunda√ß√£o</td>
                <td>{RISCO_INUND_CLASSE}</td>
                <td><span class="status {RISCO_INUND_COR}">{RISCO_INUND_GRAU}</span></td>
                <td>{RISCO_INUND_RECOM}</td>
            </tr>
            <tr>
                <td>Movimento de Massa</td>
                <td>{RISCO_MOV_CLASSE}</td>
                <td><span class="status {RISCO_MOV_COR}">{RISCO_MOV_GRAU}</span></td>
                <td>{RISCO_MOV_RECOM}</td>
            </tr>
        </table>
        <p class="small">
            <strong>Base:</strong> Camadas AMFRI_PB_Suscetibilidade_Inundacao e AMFRI_PB_Suscetibilidade_Movimento_Massa
        </p>
    </div>

    <!-- Inclina√ß√£o do Terreno -->
    <div class="section">
        <h2>8. Inclina√ß√£o do Terreno</h2>
        <table>
            <tr>
                <th width="30%">Faixa de Inclina√ß√£o</th>
                <th width="15%">Cor</th>
                <th width="20%">√Årea (m¬≤)</th>
                <th width="15%">% da √Årea</th>
                <th width="20%">Status APP</th>
            </tr>
            {TABELA_INCLINACAO}
        </table>
        <p class="small">
            <strong>Base:</strong> Camada raster de inclina√ß√£o (PB.slope.graus)<br>
            <strong>Legenda de cores:</strong>
            <span style="background-color:#1a9641; color:white; padding:2px 8px; margin:0 5px; border:1px solid #0d7a2f; border-radius:3px;">‚â§ 3¬∞</span>
            <span style="background-color:#fbfdbc; padding:2px 8px; margin:0 5px; border:1px solid #e6e6a3; border-radius:3px;">3¬∞-8¬∞</span>
            <span style="background-color:#fee4a1; padding:2px 8px; margin:0 5px; border:1px solid #f5d088; border-radius:3px;">8¬∞-15¬∞</span>
            <span style="background-color:#fec981; padding:2px 8px; margin:0 5px; border:1px solid #f5b868; border-radius:3px;">15¬∞-30¬∞</span>
            <span style="background-color:#fdae61; padding:2px 8px; margin:0 5px; border:1px solid #f59c48; border-radius:3px;">30¬∞-45¬∞</span>
            <span style="background-color:#d7191c; color:white; padding:2px 8px; margin:0 5px; border:1px solid #b81417; border-radius:3px;">> 45¬∞ (APP)</span><br>
            <strong>Nota:</strong> √Åreas com inclina√ß√£o superior a 45¬∞ s√£o consideradas APP conforme legisla√ß√£o ambiental.
        </p>
    </div>

    <!-- Notas e Condicionantes -->
    <div class="section">
        <h2>9. Notas e Condicionantes Aplicadas</h2>
        
        <!-- Notas T√©cnicas do Anexo III -->
        {if LISTA_NOTAS_ANEXO}
        <div class="alert alert-medium">
            <strong>Notas T√©cnicas do Anexo III:</strong>
            <ul class="note-list">
                {LISTA_NOTAS_ANEXO}
            </ul>
        </div>
        {endif}

        <!-- Condicionantes Urban√≠sticas -->
        {if LISTA_CONDICIONANTES}
        <div class="alert alert-low">
            <strong>Condicionantes Urban√≠sticas:</strong>
            <ul class="note-list">
                {LISTA_CONDICIONANTES}
            </ul>
        </div>
        {endif}

        <!-- Restri√ß√µes e Pend√™ncias -->
        {if LISTA_RESTRICOES}
        <div class="alert alert-high">
            <strong>Restri√ß√µes e Pend√™ncias:</strong>
            <ul class="note-list">
                {LISTA_RESTRICOES}
            </ul>
        </div>
        {endif}

        <!-- Placeholder antigo (para compatibilidade) -->
        {if LISTA_NOTAS}
        <div class="alert alert-medium">
            <strong>Observa√ß√µes Gerais:</strong>
            <ul class="note-list">
                {LISTA_NOTAS}
            </ul>
        </div>
        {endif}
    </div>

    <!-- Rodap√© -->
    <div class="footer">
        <p>
            <strong>Lei Complementar n¬∫ 275/2025</strong> - Plano Diretor Municipal de Porto Belo<br>
            Anexo III - Zoneamento e Par√¢metros Urban√≠sticos<br>
            Relat√≥rio gerado automaticamente pelo Sistema Z√¥ni v2 ({VERSAO})<br>
            <em>Este √© um documento t√©cnico para an√°lise interna. Consulte a legisla√ß√£o vigente para decis√µes finais.</em>
        </p>
    </div>

    <!-- Debug -->
    <div class="debug" id="debug-section">
        <h3>DEBUG - Contexto Completo</h3>
        {DEBUG_CTX}
    </div>
</div>

<script>
    function toggleDebug() {
        var debug = document.getElementById('debug-section');
        debug.style.display = debug.style.display === 'block' ? 'none' : 'block';
    }

    // Processa condicionais do template
    document.addEventListener('DOMContentLoaded', function() {
        // Substitui {if ...} e {endif} por manipula√ß√£o de DOM
        var elements = document.querySelectorAll('[class*="alert"]');
        elements.forEach(function(el) {
            if (el.innerHTML.indexOf('<li>') === -1 || el.innerHTML.indexOf('<li>Nenhum</li>') !== -1) {
                el.style.display = 'none';
            }
        });
    });
</script>

</body>
</html>